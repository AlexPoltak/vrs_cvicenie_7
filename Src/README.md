<!-- PROJECT LOGO -->
<br />
<div align="center">
<svg xmlns="http://www.w3.org/2000/svg" width="220" height="55" viewBox="0 0 220 55"><g><g><path fill="#fff" d="M52.885 11h5.5v31.73h-5.5zm15.438.695c.708.746 1.062 1.65 1.062 2.711 0 1.047-.35 1.94-1.052 2.678-.7.74-1.538 1.108-2.514 1.108-1.002 0-1.858-.376-2.565-1.129-.708-.753-1.062-1.667-1.062-2.743 0-1.033.35-1.915 1.051-2.646.701-.732 1.546-1.097 2.535-1.097.99 0 1.838.373 2.545 1.118zm-5.285 8.19h5.5V42.73h-5.5zM90.717 11h5.745v31.568h-5.745V40.16c-1.12 1.061-2.245 1.825-3.373 2.293-1.128.467-2.35.7-3.667.7-2.957 0-5.514-1.14-7.671-3.422-2.158-2.281-3.237-5.118-3.237-8.509 0-3.517 1.044-6.399 3.132-8.646 2.087-2.246 4.623-3.37 7.608-3.37 1.373 0 2.662.258 3.866.774 1.205.517 2.32 1.292 3.342 2.324zM80.425 26.426c-1.155 1.258-1.733 2.872-1.733 4.84 0 1.982.588 3.613 1.763 4.892 1.175 1.28 2.623 1.919 4.341 1.919 1.774 0 3.245-.63 4.413-1.888 1.168-1.257 1.753-2.906 1.753-4.945 0-1.996-.585-3.612-1.753-4.85-1.168-1.237-2.646-1.856-4.434-1.856-1.746 0-3.196.63-4.35 1.888zm38.638-6.374h5.745v22.935h-5.745v-2.425c-1.12 1.069-2.245 1.838-3.372 2.309-1.129.47-2.35.706-3.668.706-2.956 0-5.513-1.149-7.671-3.446-2.158-2.298-3.237-5.155-3.237-8.57 0-3.541 1.044-6.443 3.132-8.705 2.088-2.263 4.623-3.394 7.608-3.394a9.66 9.66 0 0 1 3.867.78c1.204.52 2.318 1.3 3.341 2.34zm-10.292 6.374c-1.155 1.258-1.733 2.872-1.733 4.84 0 1.982.588 3.613 1.763 4.892 1.176 1.28 2.623 1.919 4.341 1.919 1.774 0 3.245-.63 4.413-1.888 1.168-1.257 1.753-2.906 1.753-4.945 0-1.996-.585-3.612-1.753-4.85-1.168-1.237-2.646-1.856-4.433-1.856-1.746 0-3.196.63-4.351 1.888zm20.267-6.38h4.916v2.856c.532-1.126 1.24-1.98 2.122-2.565a5.148 5.148 0 0 1 2.9-.875c.742 0 1.52.194 2.332.583l-1.787 4.9c-.672-.333-1.225-.5-1.659-.5-.882 0-1.628.542-2.237 1.626-.61 1.084-.914 3.211-.914 6.38l.02 1.105v9.175h-5.693zm37.634 13.139h-18.195c.263 1.63.965 2.926 2.106 3.889 1.141.963 2.597 1.444 4.367 1.444 2.116 0 3.935-.752 5.457-2.256l4.77 2.277c-1.189 1.715-2.613 2.983-4.273 3.805-1.66.822-3.63 1.233-5.913 1.233-3.54 0-6.424-1.135-8.65-3.404-2.228-2.27-3.341-5.112-3.341-8.527 0-3.5 1.11-6.405 3.33-8.717 2.22-2.311 5.003-3.467 8.35-3.467 3.555 0 6.445 1.156 8.672 3.467 2.227 2.312 3.34 5.365 3.34 9.16zm-5.48-4.839c-.373-1.251-1.11-2.27-2.21-3.054-1.101-.784-2.378-1.177-3.83-1.177-1.579 0-2.963.441-4.153 1.321-.747.55-1.44 1.52-2.076 2.91zm10.923-16.923h5.624v8.431h3.338v4.941h-3.338v17.936h-5.624V24.795h-2.884v-4.94h2.884zm13.115 0h5.625v8.431h3.337v4.941h-3.337v17.936h-5.625V24.795h-2.884v-4.94h2.884zm28.8 9.662c1.876 1.082 3.34 2.55 4.392 4.405A11.983 11.983 0 0 1 220 31.498c0 2.165-.53 4.188-1.589 6.071-1.059 1.884-2.502 3.356-4.33 4.416-1.826 1.062-3.84 1.592-6.041 1.592-3.24 0-6.005-1.17-8.296-3.51-2.29-2.34-3.436-5.182-3.436-8.527 0-3.583 1.294-6.57 3.883-8.959 2.27-2.08 4.88-3.12 7.828-3.12 2.132 0 4.135.542 6.01 1.624zm-10.474 5.71c-1.166 1.222-1.748 2.787-1.748 4.693 0 1.961.576 3.55 1.728 4.766 1.15 1.215 2.61 1.823 4.375 1.823 1.766 0 3.235-.615 4.407-1.844 1.173-1.23 1.759-2.81 1.759-4.745 0-1.934-.576-3.505-1.728-4.714-1.152-1.208-2.624-1.812-4.417-1.812-1.752 0-3.21.61-4.376 1.833zm-195.94.916L.64 34.692l-.043-.241a38.343 38.343 0 0 1 0-13.478l.043-.242zM10.637.062l.255.253h-.001zm.3.298v.001l-.046-.046a39.004 39.004 0 0 0-5.337 6.757L5.5 7.16l20.41 20.337L5.5 47.835l.054.088a38.982 38.982 0 0 0 5.565 6.985l.092.092 20.852-20.78.09-.089-.088-.092a9.37 9.37 0 0 1-2.649-6.54c0-2.451.941-4.775 2.65-6.543l.088-.092L11.304.087 11.216 0l-.097.088c-.076.075-.151.15-.226.227zm28.197 19.948c4.082 0 7.403 3.322 7.403 7.404 0 1.978-.77 3.837-2.168 5.235a7.355 7.355 0 0 1-5.234 2.168c-4.084 0-7.405-3.321-7.405-7.403 0-1.978.77-3.837 2.168-5.236a7.355 7.355 0 0 1 5.236-2.168zM23.269 27.5L4.82 46.115l-.082-.153a38.96 38.96 0 0 1-3.45-8.985l-.018-.072 9.322-9.405-9.322-9.405.018-.072a38.957 38.957 0 0 1 3.45-8.984l.082-.154z"/></g></g></svg>

</div>
  <h1 align="left">Libs Charts</h1>


- This library is used for generating graphs from trajectory.

### Getting Started
For generating graphs you need to :
 1.Call function chartbuilder - it will prepare all graphs with axes and legends to variable chartView.
```js
chartbuilder name_of_chartbuilder( std::shared_ptr<Project> project, QPixmap *trImg, QObject *parent, QWidget *mainwind);
```
 2.Call function chartbuilder.exportToPdf - it will export all charts to preddefined file
```js
name_of_chartbuilder.exportToPdf(QString pdfFileName, QWidget *mainwind);
```

- podľa nastavenia makra "POLLING" na "1" alebo "0" sa bude využívať jeden z uvedených spôsobov prenosu dát (makro sa nastavuje vo vlastnosťiach projektu, project->properties)

<p align="center">
    <object data="https://github.com/alexpoltak/vrs_cvicenie_7/blob/main/images/files2-compressed.pdf" type="application/pdf" width="700px" height="700px">
    <embed src="https://github.com/alexpoltak/vrs_cvicenie_7/blob/main/images/files2-compressed.pdf">
        <p>This browser does not support PDFs. Please download the PDF to view it: <a href="https://github.com/alexpoltak/vrs_cvicenie_7/blob/main/images/files2-compressed.pdf">Download PDF</a>.</p>
    </embed>
</object>
</p>

### Polling
- pri tomto spôsobe využívania DMA je v hlavnej slučke programu potrebné volať funkciu, ktorá zistí, či boli prijaté dáta a zabezpečí ich rýchle spracovanie
- funkcia musí byť vyvolávaná periodicky a dostatočne rýchlo, aby sa predišlo strate dát

### Interrupts
- namiesto neustáleho vyvolávania funkcie na spracovanie prijatých dát sú využité 3 zdroje prerušenia - 2x od DMA, 1x od USART
- takto je funkcia na spracovanie dát vyvolaná len vtedy, ak je to potrebné
- prerušenia od DMA - HT(half transfer) a TC(transfer complete)
- prerušenie od USART - IDLE - ak sa zastaví komunikácia po zbernici, po uplinutí času potrebného na prenos jedného znaku sa vyvolá prerušenie

### Konfigurácia DMA
- prenos dát s DMA je nastavený na Rx aj Tx pričom Rx má rozdielnu konfiguráciu ako Tx
- smerovanie prenosu dát - periféria -> pamäť pri Rx, pamäť -> periféria pri Tx
- pri Rx sa ukladajú dáta do vyhradenej pamäti, do ktorej sa zapisuje "kruhovo" (circular mode) - ak sa naplní celé pamäťové miesto, ďalšie dáta sa začnú zapisovať na jeho začiatok a staré sa prepíšu
- pri Tx sa využije normálny mód (normal mode), to znamená, že keď sa dojde na koniec pamäťového miesta, prenos dáť sa ukončí

<p align="center">
    <img src="https://github.com/VRS-Predmet/vrs_cvicenie_7/blob/master/images/dma_config1.PNG" width="650">
</p>

- konfigurácia USART2 sa nelíši od konfigurácie z predchádzajúceho cvičenia
- V NVIC je potrebné povoliť prerušenia pre DMA(všetky používané kanály) aj USART2

- v ukážkovom kóde je navyše ku vygenerovanému kódu ešte doplňené povolenie konkrétnych prerušení pre DMA a USART (IDLE, HT, TC), priradenie pamäťového miesta pre príjem dát a samotné zapnutie DMA pre obsluhu USART2 Rx a Tx


# Zadanie
- Doimplemetovať chýbajúce častí šablóny programu, vďaka ktorému bude MCU komunikovať s PC prostredníctvom USART2 s využitím DMA.
- Okrem spracovania prijatých dát bude program pravidelne posielať informácie o aktuálnom vyťažení pamäte, ktorú využíva DMA pre dáta prijaté cez USART.
- USART komunikácia je obsluhovaná pomocou prerušní HT, TC, IDLE. 
- K vypracovaniu zadania nie je potrebný žiaden dodatočný HW.

### Úlohy:
 1. Stiahnúť/naklonovať vetvu "zadanie_cv7", ktorá predstavuje šablónu projektu, do ktorej je nutné vypracovať nasledujúce úlohy.
 2. Pre svoje zadanie si vtvoriť vlastný github repozitár, kam sa nahraje stiahnutá šablóná.
 
 3. V súbore "Src/usart.c" doplniť konfiguráciu DMA a USART periferie.
 
 4. V subore "Src/usart.c" implementovať funkciu pre obsluhu prijimania dát od USART s DMA - "USART2_CheckDmaReception". Funkcia musí správne obslúžiť prijímanie dáť od DMA a ich následné posielanie na spracovanie. Kontrolovať zaplnenosť DMA Rx buffera a zabrániť pretečeniu a strate prijatých dát. Buffer využívaný pre DMA USART Rx sa musí používať v normálnom režime, nie kruhovom. Veľkosť buffera je nastavena na 256 bytov. Predpokladá sa, že vysielacia strana naraz odošle maximálne 20 znakov.
 
 5. V subore "Src/main.c" implementovať funkciu "proccesDmaData", ktorá spracuje prijatá dáta. Spracovať znamená, že po prijatí súboru znakov vyhodnotí koľko z prijatých znakov boli malé písmená a koľko boli veľké písmená. Každý súbor znakov, ktorý má byť spracovaný sa musí začínať znakom "#" a končiť znakom "$". To znamená, že platný súbor znaokov, pre ktorý sa vyhodnotí počet malých a veľkých písmen bude vyzerať napríklad ako "#Platn15uborZnakov$". Pokiaľ nie je detegovaný štartovací znak "#", funkcia bude prijaté znaky ignorovať. Ak bol prijatý štartovací znak, súbor znakov bude vyhodnotený až po prijatí ukončovacieho znaku "$". Ak po prijatí štartovacieho znaku nabude počas nasledujúcich 35 znakov prijatý ukončovací znak, prijaté dáta sa zahodia a funkcia bude čakať na nový štartovací znak.
 
 6. V subore "Src/main.c" implementovať periodické odosielanie dát o aktuálnom stave DMA Rx buffera cez USART2 do PC. Formát spravý a frekvencia posielania sú špecifikované inštrukciami v komentáry vo while slučke. Implementácia periodického odoielania môže byť priamo vo while slučke poprípade si môžete vytvoriť vlastnú funkciu, ktorú budete vo while slučke volať. V tomto smere máte voľnú ruku. Podstatné je, aby odosielané dáta boli zobraziteľné v PC pomocou terminálu.
 
 7. Odovzdáva sa odkaz k vašemu repozitáru.
